<div class="create-container">
  <div class="header">
    <h2>Update Lecture</h2>
    <button type="button" routerLink="/lectures" class="btn btn-secondary">Back to List</button>
  </div>

  <form [formGroup]="lectureForm" (ngSubmit)="submit()" class="lecture-form">

    <div class="form-section">
      <h3>Lecture Information</h3>

      <!-- Title -->
      <div class="form-row">
        <div class="form-group">
          <label for="title">Lecture Title *</label>
          <input id="title" type="text" formControlName="title" class="form-control"
            [class.is-invalid]="lectureForm.get('title')?.invalid && lectureForm.get('title')?.touched"
            placeholder="Enter lecture title">
          @if (lectureForm.get('title')?.invalid && lectureForm.get('title')?.touched){
            <div class="error-message">Lecture title is required</div>}
        </div>
      </div>

      <!-- Title -->
      <div class="form-row">
        <div class="form-group">
          <label for="content">Lecture Content *</label>
          <input id="content" type="text" formControlName="content" class="form-control"
            [class.is-invalid]="lectureForm.get('content')?.invalid && lectureForm.get('content')?.touched"
            placeholder="Enter lecture content">
          @if (lectureForm.get('content')?.invalid && lectureForm.get('content')?.touched){
            <div class="error-message">Lecture content is required</div>}
        </div>
      </div>

      <!-- Course Dropdown -->
      <div class="form-row">
        <div class="form-group">
          <label for="courseId">Course *</label>
          <select id="courseId" formControlName="courseId" class="form-control"
            (change)="onCourseChange()">
            <option value="">-- Select Course --</option>
            @for(course of courses; track course.id){
              <option [value]="course.id">{{ course.name }}</option>
            }
          </select>
        </div>
      </div>

      <!-- Chapter Dropdown -->
      <div class="form-row">
        <div class="form-group">
          <label for="chapterId">Chapter *</label>
          <select id="chapterId" formControlName="chapterId" class="form-control"
            [disabled]="!lectureForm.get('courseId')?.value">
            <option value="">-- Select Chapter --</option>
            @for(chap of chapters; track chap.id){
              <option [value]="chap.id">{{ chap.name }}</option>
            }
          </select>
        </div>
      </div>

      <!-- Video URL -->
      <div class="form-row">
        <div class="form-group">
          <label for="videoUrl">Video URL</label>
          <input id="videoUrl" type="text" formControlName="videoUrl" class="form-control"
            placeholder="Enter video URL">
        </div>
      </div>

      <!-- PDF Upload -->
      <div class="form-row">
        <div class="form-group">
          <label for="pdfFile">Upload PDF</label>
          <input id="pdfFile" type="file" accept="application/pdf" class="form-control"
            (change)="onPdfSelected($event)">

          <!-- عرض الـ PDF القديم -->
          @if(lectureForm.get('pdfUrl')?.value){<div class="mt-2" >
            <a [href]="lectureForm.get('pdfUrl')?.value" target="_blank">
              View Current PDF
            </a>
          </div>}

          <!-- عرض الملف الجديد المختار -->
          @if(pdfFile){<div class="mt-2" >
            <strong>Selected New File:</strong> {{ pdfFile.name }}
          </div>}
        </div>
      </div>

      <!-- Quiz -->
      <div class="form-row">
        <div class="form-group">
          <label for="quizTime">Quiz Time (minutes) *</label>
          <input id="quizTime" type="number" formControlName="quizTime" class="form-control">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="quizTryCount">Quiz Try Count *</label>
          <input id="quizTryCount" type="number" formControlName="quizTryCount" class="form-control">
        </div>
      </div>

    

      <!-- Visibility -->
      <div class="form-row">
        <div class="form-group">
          <label>
            <input type="checkbox" formControlName="isVisible" /> Visible
          </label>
        </div>
      </div>

    </div>

    <div class="form-actions">
      <button type="button" routerLink="/lectures" class="btn btn-secondary" [disabled]="loading">
        Cancel
      </button>
      <button type="submit" class="btn btn-primary" [disabled]="lectureForm.invalid || loading">
        @if (loading) {
          <span class="spinner"></span>
          Updating...
        } @else {
          Update Lecture
        }
      </button>
    </div>
  </form>

  @if (loading) {
    <div class="loading-overlay">
      <div class="loading-spinner">Processing...</div>
    </div>
  }
</div>
