<div class="create-container">
  <div class="header">
    <h2>Update Lecture</h2>
    <button type="button" routerLink="/lectures" class="btn btn-secondary">Back to List</button>
  </div>

  <form [formGroup]="lectureForm" (ngSubmit)="submit()" class="lecture-form">

    <!-- Basic Information Section -->
    <div class="form-section">
      <h3>Lecture Information</h3>

      <!-- Title -->
      <div class="form-group">
        <label for="title">Lecture Title *</label>
        <input id="title" type="text" formControlName="title" class="form-control" placeholder="Enter title">
      </div>

      <!-- Content -->
      <div class="form-group">
        <label for="content">Content *</label>
        <input id="content" type="text" formControlName="content" class="form-control" placeholder="Enter content">
      </div>

      <!-- Course -->
      <div class="form-group">
        <label for="courseId">Course *</label>
        <select id="courseId" formControlName="courseId" class="form-control" (change)="onCourseChange($event)">
          <option value="">-- Select Course --</option>
          @for (c of courses; track $index) {
            <option [value]="c.id">{{ c.name }}</option>
          }
        </select>
      </div>

      <!-- Chapter -->
      <div class="form-group">
        <label for="chapterId">Chapter *</label>
        <select id="chapterId" formControlName="chapterId" class="form-control" [disabled]="lectureForm.get('chapterId')?.disabled">
          <option value="">-- Select Chapter --</option>
          @for (chap of chapters; track $index) {
            <option [value]="chap.id">{{ chap.name }}</option>
          }
        </select>
      </div>

      <!-- Video -->
      <div class="form-group">
        <label for="videoUrl">Video URL</label>
        <input id="videoUrl" type="text" formControlName="videoUrl" class="form-control" placeholder="Enter video URL">
      </div>

      <!-- Existing PDFs -->
      @if (existingPdfs.length > 0) {
      <div class="form-group">
        <label>Existing PDFs:</label>
        <ul class="pdf-list">
          @for (pdf of existingPdfs; track $index; let i = $index) {
          <li class="pdf-item">
            <a [href]="pdf" target="_blank">PDF {{ i + 1 }}</a>
            <button type="button" class="btn btn-sm btn-danger" (click)="removeExistingPdf(i)">Remove</button>
          </li>
          }
        </ul>
      </div>
      }

      <!-- Upload New PDFs -->
      <div class="form-group">
        <label for="pdfFile">Add New PDFs</label>
        <input id="pdfFile" type="file" accept="application/pdf" multiple class="form-control" (change)="onPdfSelected($event)">
      </div>

      @if (pdfFiles.length > 0) {
      <div class="form-group">
        <label>New PDFs:</label>
        <ul class="pdf-list">
          @for (file of pdfFiles; track $index; let i = $index) {
          <li class="pdf-item">
            <span>{{ file.name }}</span>
            <button type="button" class="btn btn-sm btn-danger" (click)="removeNewPdf(i)">Remove</button>
          </li>
          }
        </ul>
      </div>
      }

      <!-- Quiz Settings -->
      <div class="form-group">
        <label>Quiz Time (minutes)</label>
        <input type="number" formControlName="quizTime" class="form-control">
      </div>

      <div class="form-group">
        <label>Quiz Try Count</label>
        <input type="number" formControlName="quizTryCount" class="form-control">
      </div>

      <div class="form-group">
        <label>Quiz Count</label>
        <input type="number" formControlName="quizCount" class="form-control">
      </div>

      <!-- Visibility -->
      <div class="form-group">
        <label><input type="checkbox" formControlName="isVisible"> Visible</label>
      </div>

      <!-- Actions -->
      <div class="form-actions">
        <button type="button" routerLink="/lectures" class="btn btn-secondary" [disabled]="loading">Cancel</button>
        <button type="submit" class="btn btn-primary" [disabled]="lectureForm.invalid || loading">
          @if (loading) { Updating... } @else { Update Lecture }
        </button>
      </div>
    </div>
  </form>

  @if (loading) {
  <div class="loading-overlay">
    <div class="loading-spinner">Processing...</div>
  </div>
  }
</div>
