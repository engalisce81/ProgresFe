<div class="create-container">
  <div class="header">
    <h2>Create New Lecture</h2>
    <button type="button" routerLink="/lectures" class="btn btn-secondary">Back to List</button>
  </div>

  <form [formGroup]="lectureForm" (ngSubmit)="submit()" class="lecture-form">

    <!-- Basic Information Section -->
    <div class="form-section">
      <h3>Basic Information</h3>

      <!-- Lecture Title -->
      <div class="form-row">
        <div class="form-group">
          <label for="title">Lecture Title *</label>
          <input id="title" type="text" formControlName="title" class="form-control"
            [class.is-invalid]="lectureForm.get('title')?.invalid && lectureForm.get('title')?.touched"
            placeholder="Enter lecture title">
          @if (lectureForm.get('title')?.invalid && lectureForm.get('title')?.touched) {
            <div class="error-message">Lecture title is required</div>
          }
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="content">Lecture Content *</label>
          <input id="content" type="text" formControlName="content" class="form-control"
            [class.is-invalid]="lectureForm.get('content')?.invalid && lectureForm.get('content')?.touched"
            placeholder="Enter lecture content">
          @if (lectureForm.get('content')?.invalid && lectureForm.get('content')?.touched) {
            <div class="error-message">Lecture content is required</div>
          }
        </div>
      </div>
      <!-- Course Dropdown -->
      <div class="form-row">
        <div class="form-group">
          <label for="courseId">Course *</label>
          <select id="courseId" formControlName="courseId" class="form-control" (change)="onCourseChange($event)"
            [class.is-invalid]="lectureForm.get('courseId')?.invalid && lectureForm.get('courseId')?.touched">
            <option value="">-- Select Course --</option>
            @for(course of courses; track $index){
              <option [value]="course.id">{{ course.name }}</option>
            }
          </select>
          @if (lectureForm.get('courseId')?.invalid && lectureForm.get('courseId')?.touched) {
            <div class="error-message">Course is required</div>
          }
        </div>
      </div>

      <!-- Chapter Dropdown -->
      <div class="form-row">
        <div class="form-group">
          <label for="chapterId">Chapter *</label>
          <select id="chapterId" formControlName="chapterId" class="form-control"
            [disabled]="lectureForm.get('chapterId')?.disabled"
            [class.is-invalid]="lectureForm.get('chapterId')?.invalid && lectureForm.get('chapterId')?.touched">
            <option value="">-- Select Chapter --</option>
            @for(chap of chapters; track $index){
              <option [value]="chap.id">{{ chap.name }}</option>
            }
          </select>
          @if (lectureForm.get('chapterId')?.invalid && lectureForm.get('chapterId')?.touched) {
            <div class="error-message">Chapter is required</div>
          }
        </div>
      </div>

      <!-- Video URL -->
      <div class="form-row">
        <div class="form-group">
          <label for="videoUrl">Video URL</label>
          <input id="videoUrl" type="text" formControlName="videoUrl" class="form-control"
            placeholder="Enter video URL">
        </div>
      </div>

      <!-- PDF Upload -->
      <!-- PDF Upload -->
<div class="form-row">
  <div class="form-group">
    <label for="pdfFile">Upload PDFs</label>
    <input
      id="pdfFile"
      type="file"
      accept="application/pdf"
      multiple
      class="form-control"
      (change)="onPdfSelected($event)"
    />
  </div>
</div>

<!-- ✅ عرض قائمة ملفات PDF المختارة -->
 @if(pdfFiles.length > 0){
<div class="form-row" >
  <div class="form-group">
    <label>Selected PDFs:</label>
    <ul class="pdf-list">
      @for (file of pdfFiles; track $index) {
      <li class="pdf-item">
        <span>{{ file.name }}</span>
        <button type="button" class="btn btn-sm btn-danger" (click)="removePdf(i)">Remove</button>
      </li>}
    </ul>
  </div>
</div>}

      <!-- Quiz Settings -->
      <div class="form-row">
        <div class="form-group">
          <label for="quizTime">Quiz Time (minutes) *</label>
          <input id="quizTime" type="number" formControlName="quizTime" class="form-control"
            placeholder="Enter quiz time"
            [class.is-invalid]="lectureForm.get('quizTime')?.invalid && lectureForm.get('quizTime')?.touched">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="quizTryCount">Quiz Try Count *</label>
          <input id="quizTryCount" type="number" formControlName="quizTryCount" class="form-control"
            placeholder="Enter quiz try count"
            [class.is-invalid]="lectureForm.get('quizTryCount')?.invalid && lectureForm.get('quizTryCount')?.touched">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="quizCount">Quiz Question Count *</label>
          <input id="quizCount" type="number" formControlName="quizCount" class="form-control"
            placeholder="Enter quiz question count"
            [class.is-invalid]="lectureForm.get('quizCount')?.invalid && lectureForm.get('quizCount')?.touched">
        </div>
      </div>

      <!-- Visibility -->
      <div class="form-row">
        <div class="form-group">
          <label>
            <input type="checkbox" formControlName="isVisible" /> Visible
          </label>
        </div>
      </div>

      <div class="form-row">
  <div class="form-group checkbox-group">
    <label>
      <input type="checkbox" formControlName="isFree" />
      Is Free Lecture
    </label>
  </div>
</div>


    </div>

    <!-- Form Actions -->
    <div class="form-actions">
      <button type="button" routerLink="/lectures" class="btn btn-secondary" [disabled]="loading">
        Cancel
      </button>

      <button type="submit" class="btn btn-primary" [disabled]="lectureForm.invalid || loading">
        @if (loading) {
          <span class="spinner"></span>
          Creating...
        } @else {
          Create Lecture
        }
      </button>
    </div>
  </form>

  <!-- Loading Overlay -->
  @if (loading) {
    <div class="loading-overlay">
      <div class="loading-spinner">Processing...</div>
    </div>
  }
</div>
