<div class="create-container">
  <div class="header">
    <h2>Update Question</h2>
    <button type="button" [routerLink]="['/lectures/questions', lecId]" class="btn btn-secondary">
      Back to List
    </button>
  </div>

  <form [formGroup]="questionForm" (ngSubmit)="submit()" class="question-form">

    <!-- Basic Information Section -->
    <div class="form-section">
      <h3>Basic Information</h3>

      <!-- Title -->
      <div class="form-row">
        <div class="form-group">
          <label for="title">Question Title *</label>
          <input id="title" type="text" formControlName="title" class="form-control"
            [class.is-invalid]="questionForm.get('title')?.invalid && questionForm.get('title')?.touched"
            placeholder="Enter question title">
          @if (questionForm.get('title')?.invalid && questionForm.get('title')?.touched) {
            <div class="error-message">Question title is required</div>
          }
        </div>
      </div>

      <!-- Question Type -->
      <div class="form-row">
        <div class="form-group">
          <label for="questionTypeId">Question Type *</label>
          <select id="questionTypeId" formControlName="questionTypeId" class="form-control">
            <option value="">-- Select Question Type --</option>
            @for(type of questionTypes; track $index) {
              <option [value]="type.id">{{ type.name }}</option>
            }
          </select>
          @if (questionForm.get('questionTypeId')?.invalid && questionForm.get('questionTypeId')?.touched) {
            <div class="error-message">Question type is required</div>
          }
        </div>
      </div>

      <!-- Quiz -->
      <div class="form-row">
        <div class="form-group">
          <label for="quizId">Quiz *</label>
          <select id="quizId" formControlName="quizId" class="form-control">
            <option value="">-- Select Quiz --</option>
            @for(quiz of quizzes; track $index) {
              <option [value]="quiz.id">{{ quiz.name }}</option>
            }
          </select>
          @if (questionForm.get('quizId')?.invalid && questionForm.get('quizId')?.touched) {
            <div class="error-message">Quiz is required</div>
          }
        </div>
      </div>

      <!-- Question Bank -->
      <div class="form-row">
        <div class="form-group">
          <label for="questionBankId">Question Bank</label>
          <select id="questionBankId" formControlName="questionBankId" class="form-control">
            <option value="">None</option>
            @for(bank of questionBanks; track $index) {
              <option [value]="bank.id">{{ bank.name }}</option>
            }
          </select>
        </div>
      </div>

      <!-- Score -->
      <div class="form-row">
        <div class="form-group">
          <label for="score">Score *</label>
          <input id="score" type="number" formControlName="score" class="form-control"
            placeholder="Enter question score">
          @if (questionForm.get('score')?.invalid && questionForm.get('score')?.touched) {
            <div class="error-message">Score is required</div>
          }
        </div>
      </div>
    </div>

    <!-- Answers Section -->
    <div class="form-section">
      <h3>Answers</h3>
      <div formArrayName="answers">
        @for(answer of answers.controls; track $index; let i = $index) {
          <div class="form-row" [formGroupName]="i">
            <div class="form-group">
              <label>Answer {{ i + 1 }}</label>
              <input formControlName="answer" class="form-control" placeholder="Enter answer text">
            </div>
            <div class="form-group checkbox-group">
              <label>
                <input type="checkbox" formControlName="isCorrect" /> Correct
              </label>
            </div>
            @if (answers.length > 1) {
              <button type="button" class="btn btn-danger" (click)="removeAnswer(i)">Remove</button>
            }
          </div>
        }
      </div>
      <button type="button" class="btn btn-secondary" (click)="addAnswer()">Add Answer</button>
    </div>

    <!-- Form Actions -->
    <div class="form-actions">
      <button type="button" [routerLink]="['/lectures/questions', lecId]" class="btn btn-secondary" [disabled]="loading">
        Cancel
      </button>

      <button type="submit" class="btn btn-primary" [disabled]="questionForm.invalid || loading">
        @if (loading) {
          <span class="spinner"></span>
          Updating...
        } @else {
          Update Question
        }
      </button>
    </div>
  </form>

  <!-- Loading Overlay -->
  @if (loading) {
    <div class="loading-overlay">
      <div class="loading-spinner">Processing...</div>
    </div>
  }
</div>
